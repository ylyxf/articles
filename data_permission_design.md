# 一种关于数据权限的设计方法

我们可以用shiro来控制系统的功能权限，但是遇到数据权限的时候，shiro本身提供的功能有限，需要对其进行扩展。

## Linux的数据权限管理

Linux系统中面对的数据，其实就是文件。Linux系统对文件的权限控制有两种体系，一种是传统的UGO模式，一种是ACL模式。
UGO模式有一个弱点，它只能将文件的访问者分为三种角色：User(Owner)、Group(Users in Owner's Group)、Other。然后定义每个文件对这三种角色的增删改（rwx）权限。对应到一个CRM业务系统中，比如张三录入了一个新的客户信息，那么这个客户是属于张三的，我们可以定义张三能不能对它进行增删改；然后还可以定义张三所在的小组能不能对它进行增删改，最后可以定义除了张三和张三所在的小组之外的人能不能对它进行增删改。这在一个业务系统中，应该是不够的：比如李四、王五和张三在一个组中，如果业务要求李四能看到张三的客户但是王五不能，那么UGO模式就不够用了。ACL则可以弥补这个缺点，非常细致地管理哪个账户/分组对某个文件的rwx权限。

## 在业务系统中控制数据权限
## 行权限
#### 根据数据特征控制
业务系统中的数据往往会有自身的特征，比如：id、创建人、创建日期、所属部门等其它属性，我们可以拼装Query Condition来完成数据过滤，将过滤后的数据展示给当前用户。在执行delete、update操作时，同样经过QueryConditon配合要操作的业务对象id，来进行数据处理。
对相对静态的数据，我们使用id来建立QueryContion，对于动态数据，我们往往倾向使用数据特征来进行处理。

#### 根据代码特征控制。
对于使用数据自身特征较难描述的情况，比如要关联多个表进行过滤、筛选等情况，我们往往使用打标签的方式:将“自己小组成员”这个标签授予某个角色，然后在代码中，查看当前角色是否有这个标签权限，如果有，则进行某些java运算或其它操作，获得最终的数据集合。

## 列权限
业务系统中的列权限，使用代码特征控制相对简单灵活，而不是侵入到ORM框架中去做。
