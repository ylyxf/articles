# SPA适合管理信息系统吗
因为工作上的要求，最近接触并开始学习react。两个月过去了，始终不得入门。终日思索，偶得一点感想，记录下来。
## 起因
目前接手的项目，是一个稍微复杂一点的信息管理系统，大概会涉及到十几个模块。因为技术规划的统一要求，凡是新建系统，前端必须使用react，于是开始学习react。 
从网上提供的一些资料、教程可知，react主要解决的是前端页面需要频繁修改Dom的问题。频繁修改Dom会有两个问题。其一，是性能问题；其二，是代码组织与管理的问题。

性能问题，是说每当有界面上的动作，都要修改Dom，可能会导致反复修改一个Dom节点，造成不必要的性能浪费，react使用了虚拟Dom，相当于引入了一层缓冲，只把最后的结果更新到真正的Dom上去。

代码组织与管理问题，是说当个前端逻辑复杂时，传统的纯前端MVC、MVVM等数据管理手段，已经不足以hold住了，需要引入类似Flux这样的单向数据流思想来工程化地组织数据流与代码。

## 经过

看完网上的介绍后，我开始买了一本书介绍react和redux的书籍开始学习，并参考书上的例子来进行练习。

>这里有必要介绍一下我的背景，我是一名Java Web开发工程师，有10年的工作经验。对于前端的经验，仅限于一些浏览器端JavaScript库/UI组件的使用，如Jquery、【YUI】、mootools、dojo、JEasyUI等,从dojo处学习了一些JavaScript模块化开发的知识；
>另外，之前稍微接触过一点nodejs方面的内容，并简单试用过nw.js搭配oracle-node模块连接数据库等。但是因为受到java和maven等早期知识背景的影响,所以当遇到回调地狱和npm这种模块管理器及grunt、gulp等一些依赖、构建管理工具时，我就没有再深入研究以node为基础的生态环境。

那本书首先介绍了react的理念和组件化的开发思想，之后详细介绍了怎么开始开发一个计数器组件、计算器面板，最后介绍了模块化地开发一个todolist程序。我照着书本，敲完了几个章节的样例代码。因为没有ES6的基础，开始在理解上稍微有些困难，但是书上还是很贴心地随时随地介绍了ES6的语法，所以总体下来，基本没有遇到什么大的障碍。

但问题是，照着书里的样例程序，我可以把程序抄下来，调通。我却想不通，为什么要这样写代码，每一块JavaScript的代码扮演着什么角色？如果让我现在开始做一个项目，首页怎么做，框架怎么做，代码如何组织，我一点儿也不知道。原本用Jquery还可以堆砌出来一个可用的系统，而如今我束手无策。react我好像明白了一点，但是其工具栈和生态圈的思路完全让我走丢了。

## 寻因

痛苦了好久，终于在一天早上，我发现了一个之前没有注意到的细节：我们使用新工具，是为了解决之前解决不了的问题。但是react声称其解决的问题，我在之前的工作经历中根本就没有遇到过。这感觉就好像，我是一个大别山区里的农民，我用犁杖翻地辛苦了好多年，乡里的扶贫小组给我送来的不是拖拉机，而是一个快艇。扶贫小组的领导说，快艇可以让我出海捕鱼的时候，走得更远，提高我的捕鱼效率和成果。我坐在快艇里，一脸懵逼，目送村长和领导远去，任周围麦浪起伏。

react解决的第一个问题，是频繁修改Dom时产生的性能问题。但是我之前开发没怎么遇到性能问题，也没有频繁修改Dom啊？我用EasyUI开发系统的时候,要显示一个表格，直接`<table class="easyui-datagrid"><th>...</th><td>...</td></table>`就成了。对表格上数据的组织和变动，EasyUI这个库在内部都实现了，根据以往开发大型信息系统的经验，也没有出现什么性能上的问题。

但是我相信，频繁修改业务Dom这件事，EasyUI的作者肯定遇到过，其它UI库的作者们一定遇到过，他们也用他们自己的办法解决了。我作为一个UI库的使用者，其实是不关心底层的细节的，所以，react的第一个特性对我来说，并没有解决我的什么问题。

react解决的第二个问题，是关于工程化地数据管理与代码组织的问题，这个问题不是react自身解决的，而是其周边的生态系统Flux/Redux/Router等一起解决的。很不巧，这个问题我也没有遇到过。我觉得再复杂的业务系统，也没啥状态好管理的，这么多年我遇到最多的难于管理的复杂状态，就是“表单”了。比如，级联选择表单、A字段填了，B字段就得隐藏或者只读等。它涉及到了复杂的界面控制逻辑，但是也没为难到哪里去，好好组织代码就可以了。

但是我也相信，react不会无中生有，为了推广声称自己解决了一些根本不存在的问题。这中间一定有什么误会。这个误会是什么呢？在最近的一天早上朦胧之中，让我找到了答案：就是SPA。只有在单页面应用中，才会有大量的状态需要管理，而我之前从没有过开发SPA的经验。所以，react家族的第二个特性也没有帮我解决什么问题。

## 问题与思考

让我始终无法入门的症结终于找到了，我却又有一个疑问了：企业信息管理系统，用SPA的方式开发到底对不对？

这不是Jquery、React、Angularjs、Vue这些具体的框架选型问题，也不是MVC、MVVM这些模式之争，这些问题都是后话。首先需要确定的是，SPA到底适不适合企业级信息管理系统的场景？如果一个系统不适合用SPA模式开发，那么在这个领域内，就不存在react需要解决的问题了。

我们看到很多SPA的推广样例程序，大多数只是一个todolist，最复杂的也就是一个简易的邮件应用。除了gmail,似乎罕有见到具体的成功产品案例。腾讯的QQ邮箱曾经想效仿gmail，结果也没有成功，反观现在成功了的QQ邮箱应用，查看源代码，里面还有很多很‘low’的iframe。

因为之前是阿里云的深度用户，印象中的阿里云的控制台是SPA的，但是如今具体分析来看，整个应用并不是一个独立的单页面应用。控制台中的一个很小的场景（最终子菜单级别）才是一个SPA，使用angularjs实现。哪怕是域名管理下的域名列表和域名转入这两个功能关系紧密的子菜单，都不在一个SPA里面。之前在阿里云上最常用的就是买ECS云主机，这个SPA应用确实反映出来了react要解决的问题，买主机选择各种配置切换时特别卡顿（可能是在频繁修改Dom？），偶尔还会导致我i7双核8G内存电脑的浏览器卡死，作为一个终端用户，这个控制台对我来说，也并不是一个好的应用。

ant design文档前言中的谁在使用章节中，提到了`蚂蚁金服`、`阿里巴巴`、`口碑`、`美团`、`滴滴`。我打开各家的网站分析了一下，至少在官网级别，没有react的痕迹。这说明，这几家业界翘楚应该仅仅是在整个IT系统中的一些子系统中使用了，并没有整个IT系统要求全面使用。所以这里也可能是ant design开发团队的一种推广修辞，事实无误，但是表达容易引起人的联想。
>这里有必要交代一下本文作者的背景：我其实是共产主义接班人，2006年还被美国《时代周刊》评选为年度风云人物。

企业级信息管理系统，往往面对的是非常复杂的业务场景，动辄上百个功能点；但同时，功能点之间的相互依存与复杂关系大多是体现在数据层面，而不是UI表现层面。比如：项目与客户这两个业务实体，往往是分开出现的，最常用的关联性，在于当我看到这个项目时，想查看一下这个项目的客户的详细信息；或者当我看到这个客户时，我想看一下这个客户的历史项目，这些关联的场景都是“用完即走”型的，打开一个新的浏览器tab窗口或者当前页面弹出一个div层，看完就关闭了，就消失了，不会在前端有复杂的状态管理。

**企业级信息管理系统功能多、UI层面状态不多的特性，非常适合以功能点为分界，多页面相互独立开发的模式。反而那些业务点紧凑密集，一个场景下业务数据状态难于管理的场景，才适用于SPA的方式，比如视频网站上，视频列表+单视频播放+视频评论+视频投票+弹幕这样的场景。**

另外，在一些场景下不用SPA，不是说不要前后端分离。我们一直强调前后端分离，这怎么强调都不过分。前后端分离是为了解决工程方面的问题，是为了让开发、部署、运维更加灵活，非SPA的场景下，也需要前后端分离。

 
## 最后一个问题

如果不使用SPA，那么还需不需要用react呢？

>第二年春耕时，扶贫小组来我们村回访。我用马驮着快艇，发动起快艇引擎，艇后的螺旋桨高速旋转，泥土翻飞......
